---
title: "Factorial Designs"
author: "Dr Austin R Brown"
institute: "Kennesaw State University"
format:
  beamer:
    include-in-header:
      - text: |
          \usepackage{tabularx}
editor: visual
execute:
  echo: true
  include: true
  warning: false
  message: false
---

## Introduction

-   So far, we have discussed experimental situations in which we are interested in the levels of a single treatment factor.

\vskip 0.10 in

-   All of our designs, including CRD, RBD, and LSD only have one treatment factor.
    -   And of course, 0, 1, and 2 blocking factors, respectively.

\vskip 0.10 in

-   But could there be instances where we are interested in the effects of two or more treatment factors?
    -   Let's consider an example.

## Experiment Example: American Football Helmets

-   In American football, players are required to wear helmets as a means of protecting their head and face from a variety of potential injuries. One of the biggest head injury risks a player faces during game play is a concussion. It is in the interest of players at all levels to reduce this risk both in terms of the rules of the game as well as the quality of the equipment.

\vskip 0.10 in

-   Suppose a football equipment manufacturer is developing new helmet technology aimed at reducing concussion risk. They want to investigate the effectiveness of two design features:
    1.  **Outer Helmet Material**: (1) Traditional Polycarbonate and (2) New Composite
    2.  **Internal Padding System**: (1) Standard Foam Padding and (2) Advanced Gel-Based Padding

## Experiment Example: American Football Helmets

-   The manufacturer creates four different helmet prototypes, one for each combination of the two factors. To collect data, they set up a standardized rig where a stationary helmet is struck by a mechanically controlled mallet at a fixed speed, simulating the forces experienced during a head-on collision (check out this [**video**](https://www.youtube.com/watch?v=mWCxEhBR88k) for a visual example).

\vskip 0.10 in

-   Inside the helmet, a force sensor records the amount of force transmitted by the below to inside the helmet (measured in G-Force).

\vskip 0.10 in

-   For this experiment, the manufacturer produced 10 of the four prototypes for minimizing replication error. The data are contained in the `Football Helmet.xlsx` file.

## Designing the Experiment

-   As with all of our examples, we can list out our
    1.  Outcome: G-Forces measured inside the helmet after being struck
    2.  Treatments: Outer Helmet Material \underline{and} Internal Padding System
    3.  Potential Lurking Variables: Could happen if we have different operators conducting the runs of the experiment

\vskip 0.10 in

-   Next, we need to decide on the design. Here, we have two treatment variables (i.e., independent variables) and no blocking/confounding/lurking variables.
    -   So what's our design?

## Completely Randomized Two-Factor Design

-   In this case, because we have two treatment factors and no blocking factors, our experimental design would be a ***Completely Randomized Two-Factor Design***.

\vskip 0.10 in

-   Mathematically:

$$ y_{ijk} = \mu + \alpha_i + \beta_j + (\alpha\beta)_{ij} + \varepsilon_{ijk} $$

## Completely Randomized Two-Factor Design

-   You may be asking yourself, "how does this conceptually differ from RBD?" Great question!

\vskip 0.10 in

-   The answer is subtle. In RBD and LSD, we assumed the blocking factors didn't interact with the treatment factor (or each other in the case of LSD).
    -   In this two-factor design, we are assuming that there may be an **interaction** between Treatment 1 (denoted by $\alpha$) and Treatment 2 (denoted by $\beta$).

\vskip 0.10 in

-   This interaction effect is denoted by $(\alpha\beta)_{ij}$.

## Completely Randomized Two-Factor Design

-   Additionally, in RBD and LSD, we completely ignored the F-tests associated with the blocking factors.

\vskip 0.10 in

-   In this two-factor design, we are interested in the test for both treatments as well as their interactions.

\vskip 0.10 in

-   Let's take a look at the data and start working through this example in a similar manner to what we've done before.

## Descriptive Analysis: Summary Statistics

-   Let's start by examining the means and standard deviations of the Shell type:

\scriptsize

```{r}
library(tidyverse)
library(readxl)
library(rstatix)
## Read in the Data ##
helmet <- read_excel("Football Helmet.xlsx")
## Calculate Means & SDs of Shell Type ##
helmet |>
  group_by(Shell) |>
  get_summary_stats(Response,type='mean_sd') |>
  select(Shell,mean,sd)
```

\normalsize

## Descriptive Analysis: Summary Statistics

-   So we can see that in general, regardless of Padding type, the New Composite helmets experience a substantially lesser force compared to the Polycarbonate helmets.
    -   This may indicate this shell-type is better at limiting head injuries.

\vskip 0.10 in

-   Let's check out the Padding type now:

## Descriptive Analysis: Summary Statistics

\scriptsize

```{r}
## Calculate Means & SDs of Padding Type ##
helmet |>
  group_by(Padding) |>
  get_summary_stats(Response,type='mean_sd') |>
  select(Padding,mean,sd)
```

\normalsize

## Descriptive Analysis: Summary Statistics

-   Here, we can see that the Gel padding type has a substantially lower force experienced compared to the Foam padding type.

\vskip 0.10 in

-   But here, unlike the cases we saw with one-factor RBD and LSD, we assume that our two treatment factors may have an interaction effect with one another.

\vskip 0.10 in

-   We can observe this effect both in the summary statistics as well as data visualizations.

## Descriptive Analysis: Summary Statistics

\scriptsize

```{r}
helmet |>
  group_by(Shell,Padding) |>
  get_summary_stats(Response,type='mean_sd') |>
  select(Shell,Padding,mean,sd)
```

\normalsize

## Descriptive Analysis: Summary Statistics

-   Observing the interactions, we can see that the polycarbonate helmets generally experience the greatest force but the gel padding does reduce the force experienced for both shell types.

\vskip 0.10 in

-   If there **is not** a significant interaction, then the change in the mean response between the Shell types would be roughly equivalent regardless of Padding type.
    -   In other words, the difference between New Composite/Gel and Polycarbonate/Gel would be the same as what's observed between New Composite/Foam and Polycarbonate/Foam.

\vskip 0.10 in

-   If there is evidence for a significant interaction, then the change in the mean response between the Shell types would be different depending on the type of Padding.
    -   In other words, the difference between New Composite/Gel and Polycarbonate/Gel would be meaningfully different compared to what's observed between New Composite/Foam and Polycarbonate/Foam.

## Descriptive Analysis: Boxplots

-   As before, we can use boxplots to visually assess the same information we generated tabularly:

\scriptsize

```{r,eval=F}
## Let's look at a boxplot to visualize the data. ##
helmet |>
  ggplot(aes(x=Shell)) +
  geom_boxplot(aes(y=Response,fill=Padding)) +
  geom_point(data = helmet |>
               group_by(Shell) |>
               get_summary_stats(Response,type='mean_sd'),
             aes(x=Shell,y=mean),shape=4,size=5) +
  theme_classic()
```

\normalsize

## Descriptive Analysis: Boxplots

```{r,echo=F}
## Let's look at a boxplot to visualize the data. ##
helmet |>
  ggplot(aes(x=Shell)) +
  geom_boxplot(aes(y=Response,fill=Padding)) +
  geom_point(data = helmet |>
               group_by(Shell) |>
               get_summary_stats(Response,type='mean_sd'),
             aes(x=Shell,y=mean),shape=4,
             size=5) +
  theme_classic()
```

## Descriptive Analysis: Boxplots

-   Here, the "X" between the boxes denotes the mean of the Shell.
    -   Clearly, the Polycarbonate shell has a greater mean, as we saw in the summary statistics.

\vskip 0.10 in

-   We can also see that the Foam padding in the Polycarbonate shell had a greater force experienced compared to the Foam padding in the New Composite shell.
    -   This may indicate a possible interaction effect between shell and padding type.

\vskip 0.10 in

-   To better examine the interaction effect, we can use an interaction plot!

## Descriptive Analysis: Interaction Plot

\scriptsize

```{r,eval=F}
helmet |>
  group_by(Shell,Padding) |>
  get_summary_stats(Response,type='mean_sd') |>
  ggplot(aes(x=Shell,y=mean,group=Padding,color=Padding)) +
  geom_point() +
  geom_line() +
  theme_classic() 
```

\normalsize

## Descriptive Analysis: Interaction Plot

```{r,echo=F}
helmet |>
  group_by(Shell,Padding) |>
  get_summary_stats(Response,type='mean_sd') |>
  ggplot(aes(x=Shell,y=mean,group=Padding,color=Padding)) +
  geom_point() +
  geom_line() +
  theme_classic() 
```

## Descriptive Analysis: Interaction Plot

-   Let's take a step back and think more generally about what an *interaction* is really referring to in context.

\vskip 0.10 in

-   Here, we're ultimately asking: does the Padding type change the force experienced differently depending on the Shell type?
    -   In other words, does foam/gel work better with polycarbonate or new composite?

\vskip 0.10 in

-   If the answer to this question is "no," then the prior plot will show us two parallel lines. If the lines are not parallel, then this may indicate the presence of a significant interaction.

## Descriptive Analysis: Interaction Plot

```{r,echo=F}
knitr::include_graphics("Interaction Plots.png")
```

## Inferential Analysis

-   Now that we have performed our appropriate descriptive analyses, we can go ahead and perform our inferential analyses (assuming all relevant assumptions have been tested...see the associated R code for details).

\vskip 0.10 in

-   Here, since we have two treatment effects and an interaction effect that are part of our experiment, we technically have three sets of statistical hypotheses we test.

## Inferential Analysis

-   **Shell Type**: $H_0: \alpha_{\text{Polycarbonate}} = \alpha_{\text{New Composite}} = 0$ vs. $H_1: \alpha_{\text{Polycarbonate}}$ or $\alpha_{\text{New Composite}}$ do not equal 0.

\vskip 0.10 in

-   **Padding Type**: $H_0: \beta_{\text{Foam}} = \beta_{\text{Gel}} = 0$ vs. $H_1: \beta_{\text{Foam}}$ or $\beta_{\text{Gel}}$ do not equal 0.

\vskip 0.10 in

-   **Interaction**: $H_0: (\alpha\beta)_{PF} = (\alpha\beta)_{PG} = (\alpha\beta)_{NF} = (\alpha\beta)_{NG} = 0$ vs. $H_1:$ at least one of these do not equal 0.

## Inferential Analysis

-   You may be asking yourself "why are the hypotheses laid out this way, with respect to the effects rather than the means?"

\vskip 0.10 in

-   The answer: this is what is actually being tested in the F-tests. Since we can write the treatment and interaction group means as functions of these effects, it is sufficient (and traditional) to focus on the effects.

\vskip 0.10 in

-   But to reiterate, because the effects are functions of the group means, we can still think of these tests as being related to the group means, because they are!

## Inferential Analysis

-   Our ANOVA table is:

\begin{table}[h]
    \centering
    \begin{tabularx}{\textwidth}{lcccc}
        \toprule
        \textbf{Source} & \textbf{df} & \textbf{SS} & \textbf{MS} & \textbf{F-Statistic}  \\
        \midrule
        \text{A} & $I-1$ & $SSA$ & $SSA/(I-1)$ & $MSA/MSE$ \\
        \text{B} & $J-1$ & $SSB$ & $SSB/(J-1)$ & $MSB/MSE$ \\
        \text{AB} & $(I-1)(J-1)$ & $SSAB$ & $\frac{SSAB}{(I-1)(J-1)}$ & $MSAB/MSE$ \\
        \text{Error} & $(r-1)IJ$ & $SSE$ & $\frac{SSE}{(r-1)IJ}$ & \\
        \bottomrule
        \text{Total} & $rIJ - 1$ & $SST$ & & \\
        \bottomrule
    \end{tabularx}
\end{table}

## Inferential Analysis

-   Let's see what our ANOVA table is in this example:

```{r}
## Fit ANOVA model ##
mod <- aov(Response ~ Shell*Padding,data=helmet)
## Obtain ANOVA table ##
library(broom)
mod |>
  tidy()
```

## Inferential Analysis

-   It is recommended that we evaluate our three hypothesis tests beginning with the interaction.

\vskip 0.10 in

-   Here, our p-value is 0.08, indicating that our data support the null hypothesis that the interaction effects are not meaningfully different from 0.

\vskip 0.10 in

-   In other words, while we did see a difference in slope in the interaction plot, the difference was not found to be statistically meaningful.

## Inferential Analysis

-   Note, if we were to have found a significant interaction effect, and especially if we were to have seen an intersection of the lines in the interaction plot, then we would have to proceed with caution in our interpretation of the treatment effects (sometimes called the "main effects")

\vskip 0.10 in

-   Why is this? The differences we might see when only examining the treatment effects aren't telling the whole story.

\vskip 0.10 in

-   We need to make sure we are telling the complete story by appropriately accounting for significant interactions.

## Inferential Analysis

-   Now, moving into the tests for the two treatment effects, we can see that both Shell and Padding are statistically significant at the 0.05 level.

\vskip 0.10 in

-   This implies that we have observed a statistically meaningful difference in mean force by Shell and by Padding type.

\vskip 0.10 in

-   In this case, since we only have two levels of each treatment effect, we don't necessarily have to perform a post-hoc test in order to know which group is greater and which group is lesser in terms of the mean response.
    -   But we could!

## Inferential Analysis

```{r}
## Tukey's PostHoc Test ##
TukeyHSD(mod) |>
  tidy() |>
  filter(term %in% c("Shell","Padding")) |>
  select(term,contrast,estimate,adj.p.value)
```

## Inferential Analysis

-   So for our contextual conclusion, we would say that if our goal was to manufacture helmets that are safest for players, we should probably use the New Composite material for the shell and the Gel for the interior padding.

## Final Thoughts

-   Factorial ANOVA can be extended to more than two treatment effects and include multiway interactions.

\vskip 0.10 in

-   In theory, while we could have a four or five way interaction, this is almost never practically interpretable. Thus, in most higher-order designs like this, we completely ignore those and mostly focus on the two-way interactions and the main effects.

\vskip 0.10 in

-   As is often the case in statistical methodology, increased model complexity often comes at the expense of practical interpretability.
